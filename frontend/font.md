# フォント

FEの開発で特定の端末でのみ、英語の文字が太字にならないという問題が発生した。  
この問題に対処した上でフォント周りを調べたので雑にメモを残しておく（私見も入っており、内容真偽は不明です...）

## フォントとは？＋反映されるまでの流れ

- フォントの実態は.woff2のようなファイルに、CMAPテーブルというそのフォントがどのUnicodeに対応しているかをものがある
- DOM構築時にUnicodeを取得し、CMAPテーブルをチェックし、フォントを確定
- そのフォントを使って描画する

## フォントの種類とか

※実際にどのようなフォントをあてるかはCSSのfont-familyで指定される

まずフォントには、どこにあるかの場所により大きく2分できる

- ローカルフォント
- Webフォント

ローカルフォントはそのままで私たちが触っている携帯やPC等にあるやつ。  
Webフォントは、Web経由で配信されているフォントのこと（Google Fontsとかが有名）

その上で、Noto Sans JPやRobot, sans-serifのようなフォント種類がある。  
sans-serifは、汎用フォントファミリであり、serif(飾り)がsans(フランス語で「無い」という意味)という意味。実際の具体のフォント名ではなく「飾りがない」フォントをあててねというものであり、実際にどのフォントがあたるかは環境によって異なる。

あとはフォントの種類によって、日本語に対応しているもの・そうでないものとかある。

## Webフォント

Webフォントを指定することで、ユーザーの環境に依存することなく、統一のフォントをあてることができる。その一方で、ページ描画時にフォントダウンロードが発生するデメリットがある（フォントは長い時間キャッシュされることが多いのでそこまで大きな問題にならないが）  
※Webフォントは、headタグ内のlinkタグで指定される（CSSとかと同様に読み込み時にダウンロードが走る）

## next/font: Next.jsでのアプローチ

- next/fontとは？
  - [最適化: フォント | Next.js](https://nextjs.org/docs/app/building-your-application/optimizing/fonts)

上記にあるが、next/fontというフォント最適化の仕組みがある。これはセルフホスティングされるので、ユーザーが表示時にフォントダウンロードが走る・レイアウトズレが生じるというようなことを発生を抑制できる。  
セルフホスティングとは、ビルド(next build)を実行するとビルド結果にwoff2ファイルが含まれる（ビルド時にフォントダウンロードしてくれる）つまり、ブラウザからGoogle等のフォント配信先へのリクエストが走らないようになる。  

### セルフホスティング vs 従来のWebフォントインストール

※従来のWebフォントインストール: headタグのlinkタグでフォント配信先URLを指定

結局どちらもブラウザからすると、ネットワーク経由のリクエスト/レスポンスが発生するからそこまでセルフホスティングにメリットがあるのか？を調べてみた。

- DNSルックアップやTLSハンドシェイクが外部サーバーに対して不要になる(セキュリティ性向上？)
- 

## 冒頭の問題解決方法

冒頭述べた問題に対しては以下の対処を行なった。

- Webフォントを採用
- font-weightを一般的な400,700を採用

まず表示する端末に依存することを避けるためWebフォントを使うことにした。  
また、今回プロジェクトで使用されていたfont-weightの太字にあたる値が600であったため、一般的な太字の700と異なり、これがそもそも特定の端末で太字にならない本あの原因だった説が高い。ので、一般的な400,700という値を統一して使用することにした（フォントが同じでも太さが異なると、フォントファイルも違うという学びも得られた）