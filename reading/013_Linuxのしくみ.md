# 試して理解 Linuxのしくみ

## 第1章 Linuxの概要

### プログラムとプロセス

- Linuxではさまざまなプログラム（一連の命令）が動いている
  - コンパイラ言語ではビルド後の実行ファイルがプログラムで、スクリプト言語ではソースコードそのものがプログラムとなる
  - そしてカーネルもプログラムの1種
- マシンの電源を入れるとまずカーネルが起動する。それ以外のすべてのプログラムはカーネルの後に起動する。
- 起動後に動作中のプログラムのことを「プロセス」という（広義にはこれもプログラムと呼ぶこともある）

### カーネル

- カーネルとは何か？なぜ必要か？というのをプロセスがストレージデバイスに直接アクセスできるシステムを例に考えてみる
- 例えばある異なる別のプロセスの実行順序が制御されず、意図しない領域へのアクセスができてしまうと問題になる
- このような問題に対処するのが、（ハードウェアの力を借りた）カーネルである
- 一般的なPCやサーバーのCPUには、カーネルモードとユーザーモードという2つのモードがある
- Linuxでは、カーネル（モード）のみがデバイスにアクセスできる
- それに対して、プロセスはユーザーモードで動作するため、デバイスにアクセスできないので、カーネルを介して間接的にデバイスにアクセスする
- まとめると
  - カーネルは、システム内の全てのプロセスが共有するリソースを一元管理して、システム上のプロセスに配分する
  - そのために、カーネルモードで動作するプログラムが「カーネル」なのである

### システムコール

- システムコールとは、プロセスがカーネルに処理を依頼するための方法
  - プロセスやメモリ、通信、ファイルシステムやデバイス管理あたり
- プロセスはユーザーモードで動いているが、システムコールを発行すると、CPUにおいて例外イベントが発生する
  - これをきっかけに**CPUのモードがユーザーモードからカーネルモードに遷移**し、依頼内容に応じたカーネルの処理が動作する
  - この動作が終わると、再びユーザーモードに戻ってプロセス本体の動作を継続する
- システムコールの冒頭で、プロセスからカーネルへの要求が正当なものかをチェックする（保有している量を超えるメモリが要求されていないかなど）
- システムコール以外で、プロセスからCPUのモードを変更する方法はない（もしあったら任意の悪意あるプロセスから攻撃できてしまう）
- システムコール発行の可視化