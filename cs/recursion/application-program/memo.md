# コンパイラとインタプリタ

- プログラミング言語は、その言語の構文と意味を規定する一連のルール
- 実際に仕様をコンピュータで実行可能なコードに変換するのはコンパイラ
- コンパイラ：プログラミング言語で書かれたソースコードを取り込み、特定のプラットフォームで実行可能な機械語に変換するアプリケーションプログラム
- インタープリタ：プログラミング言語の命令をコンパイルすることなく直接実行するプログラム
- ジャストインタイムコンパイル（JIT）：実行直前にコンパイルを行う
  - コードが実行される特定の環境に合わせて最適化されるため、全体として実行速度が速くなることがある
- コンパイルした機械語はCPUアーキテクチャに則る必要がある

### コンパイラの実行環境

- ホスト環境とフリースタンディング環境がある
- フリースタンディング環境：OSやその他の実行環境のサポートを受けずにコンパイル
  - OS開発や組み込みで使用される
- ホスト環境：OS乗で動く通常のアプリケーションの実行環境で、標準ライブラリ、システムコール、その他のAPIなどのOSとそのライブラリが提供する機能を全て利用できる
  - 一般的なWebアプリケーションで使用される
- 例えば、OSの役割の1つとしてあるファイルの作成・削除
  - アプリケーションからはファイルパスを指定するだけの同一の操作で、ハードウェア（ストレージ:SSDやHDDなど）の違いを吸収してくれる
- 実際はシステムコールのような低レベルな命令を直接操作することは少なく、多くはそれを高レベルで抽象化されたライブラリを使用する

# OS

- コンピュータのハードウェアとソフトウェアのリソースを制御・調整するソフトウェアの集合体

## カーネル

- OSには、システムコール・シェルなどの様々な機能があるが、核となるのがカーネルであり、ハートウェアの制御を行うプログラム
- カーネルは、起動時にブートローダによってメモリにロードされ、常にメモリ内に存在し、タスクを実行する

## ブートローダ

- システムに電源が入った後、ブートローダと呼ばれる特別なプログラムを通じて、カーネルがコンピュータのストレージからメモリにロードされる

## デバイスドライバ

- ストレージやマウスなどのハードウェアデバイスを認識し、アクセスするために必要なもの
- これは、特定のデバイスの内部構造を理解し、OSのデバイスとの通信と制御の方法を提供する特別なプログラム

## システムコール

- プログラムがカーネルに対して、特定の機能やサービスを実行するように要求する機能
- ユーザーはシステムコールを命令するだけで、カーネルが適切かつ安全に資源を利用して実行できる
  - 例えばユーザーが無作為にメモリアクセスやプロセスを操作できてしまうと、様々な問題が生じてしまう
- C標準ライブラリ（libc）は、OSやその他のシステムサービスに対して高水準のインターフェースを提供する関数のコレクション
  - システムコールが抽象化された関数を呼び出すだけで良いので、ユーザーはシステムコールの実装方法の詳細を気にすることはない

## シェル

- ユーザーがカーネルと対話するためのユーザーインターフェースがshell
- シェルには、様々な形態がある
  - CLI、GUI、タッチスクリーンインターフェース、音声コントロールインターフェース

# ファイル

- Linuxの場合、全てがファイル（データ）かプロセス（コンピュータが実行する一連の命令）とみなされる
- 全てのファイルは、ファイル記述子テーブル（FDT:FileDescriptorTable）と呼ばれるテーブルによって管理される
  - OSはファイルを開くと、FDTにファイルディスクリプタを作成する
- FDTは、プロセスごとに管理され（つまりプロセス間で競合しない）、以下の3つは予約されている
  - 0:stdin
  - 1:stdout
  - 2:stderr
    - これらの標準ストリームは、シェルを通してプログラムを実行するときに常に開かれており、プログラムとシェル間のデータを伝送するために使用される
- ファイルディスクリプタは、プロセスがファイルや他のオブジェクトにアクセスして操作する際に使用される
  - ファイルを閉じると、OSはFDTからファイルディスクリプタを削除し、それによりOSがそのファイルへのアクセスを許可しなくなることを意味する

# データストリーム

- プロセス間通信を学ぶ章
- 通常プロセスのメモリ空間は独立しているので他のプロセスの影響を受けない
- しかし、パイプやソケットを使用することで、必要に応じてプロセス間で通信することが可能

## パイプ

- パイプは、プロセスから別のプロセスへ単方向のデータ転送を可能にする仕組み
  - ファイルディスクリプタを介してアクセスされる
  - 親プロセスと子プロセス間の通信でも使用される
  - 双方向に通信するには、パイプが2つ必要になる
- 内部的には、ユーザー空間の自分のメモリから、カーネル内にあるパイプバッファ（専用のメモリ領域）を読み書きすることで、データをやり取りする
- パイプは、FIFOで、データストリームの伝送によく使われる
  - データストリームとは、あらかじめサイズや長さが決まっていない大量のデータを、ある場所から別の場所に送ること
    - パイプでデータを送信すると、FIFO=最初に送信したデータを最初に受信するといった直線的な流れとなる
- 名前付きパイプは、ファイルシステム上に名前をもち、無関係なプロセス同士でもデータをやり取りできる
  - 普通のパイプ（匿名パイプ）は、親子プロセス限定
  - ファイルシステムに、パイプ専用の特別なファイルを作り、そこに読み書きすることでプロセス間通信を実現する
    - ただデータはディスクに書き込まれず、メモリ内のカーネルバッファに保持されるので、少量のデータ転送やプロセス間のコマンドの通信に便利
- パイプのユースケース
  - 通常のパイプ
    - UNIXコマンドの`|`
- Pythonの`print("Hello")`で標準出力する流れ
  - Hello文字列を作る
  - `sys.stdout.write("Hello\n")`を呼び出す
  - Cの低レベルI/O関数writeを呼び出す
  - カーネル内のstdout用バッファに文字列がコピーされる
  - stdoutに紐づいた出力先に書き込む

## ソケット

- ソケットは、双方向の通信を行う
