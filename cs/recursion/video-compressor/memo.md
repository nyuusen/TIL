# バックエンドプロジェクト・Video Compressor

## プロセス

- プログラムは静的、プロセスは動的
- プログラムが実行されるときに、プロセスとしてメモリにロードされ、CPUにより命令が順次実行される
- 各プロセスは、独自のメモリ空間とプロセス制御ブロックを持っている
  - メモリ空間は、プログラムコード・データ・スタックを格納するために使用され、他のプロセスが保護されているため、各プロセスは独自のリソースを持っている（各プロセスは他から独立して動く）
  - プロセス制御ブロック（PCB）は、OSが各プロセスを管理するために使用されるデータ構造で、プロセスの状態やプロセスIDなどが含まれる
- Linuxではプロセス情報は`/proc/{PID}`ファイルシステムフォルダに格納される
  - これは仮想システムファイルで、内容はストレージではなくメモリ上に格納される
  - PIDがわかれば、`cat /proc/{PID}`でプロセスのプロセス制御ブロック（PCB）データ構造を表示できる

## 子プロセス

- プロセスは、他のプロセスを生成する能力がある
  - 具体的には、os.fork()というシステムコールで、現在のプロセスの複製＝子プロセスを作成する
- 子プロセスは、親プロセスのほとんど完全なコピーで、コード・グローバル変数・ヒープ・スタックなどのメモリレイアウトを含めたほとんど全ての内容が複製される

## パイプ

### 通常のパイプ

- 親プロセスが生成するメッセージを子プロセスが受け取るという一方向の通信を行うためには、パイプという仕組みを利用する
- パイプは、OSの機能で、1つのプロセスがパイプにデータを書き込み、別のプロセスがそのデータを読み出す

### 名前付きパイプ

- パイプはファイル記述子(fd)を通じて、2つのプロセス間でデータを直接受け渡す
  - OSがファイル記述子テーブルを管理している
  - この方法だと、グループ化されていない異なるプロセス間でパイプを共有するのは難しい
    - 各プロセスは独自のFDテーブルを持っている（非負の正数で、慣習として0が標準入力、1が標準出力、2は標準エラーが割り当てられる）
    - 関係性（祖先などの）がないプロセスはFDテーブルを共有しないため、標準的なパイプのFDを共有する手段はないという意味
    - 上でも触れたfork()による子プロセスを生成する際はFDテーブルを継承するので共有が可能
- そこで、パイプにパス名を割り当てる名前付きパイプが他のプロセスとデータを共有することができる

### (そもそも)ファイルディスクリプタとは？

- 入出力処理の抽象化と統一的な管理の核となるもの
- プログラム等からファイルやその他入出力処理を操作する際に、OSがそれらを識別するために割り当てる非負の整数値番号のこと
- これがあることにより、プログラムからはファイルであろうとソケットであろうと同じシステムコール(read()やwrite()など)を使って、**FD番号を指定するだけ**で統一的にデータの読み書きを行うことができる

#### WebアプリケーションにおけるFD

- リクエスト〜レスポンスは全てソケット通信を通じて行われ、ソケットはFDとして扱われる
  - サーバーが特定のポート番号でサーバーを起動する際、接続を待機するためリスニングソケットを作成する
    - このリスニングソケットが、1つのFDとしてOSに登録される
  - 実際にクライアントからアクセスされる際のコネクションソケットも同様

