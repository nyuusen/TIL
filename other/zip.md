# 圧縮やアーカイブ

普段なんとなく扱っている圧縮やアーカイブ、ZIPあたりをまとめる

## ZIPとは？

- DEFLATEというアルゴリズムが技術の核となっていて、DEFLATEは「LZ77」と「ハフマン符号」という大きく分けると2つの技術で構成されている
- 圧縮とアーカイブの機能を持っている

### 圧縮

- LZ77
  - データの中に以前に出てきた同じパターンがないかを探す技術
    - 例えば、「私はリンゴが好きです。あなたはリンゴが好きですか？」という文章を圧縮する場合、後半の「リンゴが好きです」を「10文字前にある7文字分のデータと同じ」という参照（ポインタ）に置き換える
  - データ量を劇的に減らせる
- ハフマン符号
  - コンピュータは通常1文字を固定のビット数（例：8ビット）で表現するが、ハフマン符号ではよく使うデータには短いコードを、たまにしか使わないデータには長いコードを割り当てる
  - 全体を固定ビットで送るよりも、ずっとデータ量が削減できる

### アーカイブ

- ZIPは圧縮だけでなく、アーカイブも行う
- ディレクトリ構造を保持したまま、複数のファイルやフォルダを1つのファイルにまとめる
- メタデータ（ファイル名・作成日時・アクセス権限など）の情報を一緒に詰め込む

## gzip

- 1つのファイルを圧縮することに特化した技術で、アーカイブ機能はない
  - なので対象は単一のファイル
  - フォルダごと圧縮したい場合は、tarで複数ファイルを1つにし、その後gzipを行う（Linuxでよく見る`.tar.gz`の拡張子がまさに）
- 中身のアルゴリズムは、ZIPと同じDEFLATEを使っている
- LinuxやUnix系では標準的
- 最近ではGoogleが開発した「Brotli」という、より高効率な圧縮技術もある

### 用途

- ZIPで良い感があるのに、gzipが使われる理由と使い道
- Webサイトの高速化
  - サーバーから送られてくるHTMLやCSS、JSは、多くの場合gzipで圧縮された状態で転送される
  - テキストデータ（コード）は重複が多いので、gzip(DEFLATE)と相性が良く、70〜80％も削減できる
  - ブラウザからアクセスした時に送られるAccept-Encodingにgzipが含まれていれば、サーバー側で有効な設定がされている場合はgzipで送られる
    - ブラウザが自動的に解凍作業をしてくれ、JSエンジンに届く頃には元のテキストデータになっている
- ログファイルの保存などにも使われる