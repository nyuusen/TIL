# 並行処理

## 並列と並行処理の違い

- 並列は、ある**点**において複数のタスクを行うこと
- 並行は、ある**範囲内**において複数のタスクを行うこと
- 並行性は、ソフトウェアで表現されたりプログラミングコードで実現される反面、並列性はハードウェアやそのプログラムが動作するプロセスで実現される
  - つまりプログラミング言語が指す性質は「並行性」となる（プログラマは並列で走ってほしいというコードを書いているが）

## 並行処理のメリット・デメリット

- 並行処理をすることで、実行時間が早くなったりする
- が、実行順が予測ができない、競合状態を避ける必要があったり、共有メモリに正しくアクセスする必要があったり、色々難しいことが多い

## ゴルーチン

> go文は渡された関数を、同じアドレス空間中で独立した並行スレッド(ゴールーチン)の中で実行します。

- 並行に実装するもので、並列で実行されるとは限らない
- メインのゴルーチンが終わると、他のゴルーチンの終了を待たずにプログラムが終了する
  - 待たせたい場合は、syncパッケージのWaitGroupを使用する

## チャネル

- メインルーチンで定義している値をチャネルで取り扱う場合は、引数で渡すようにする（`go func(i int) {...}(i)`）
- チャネル型を空の構造体にするとメモリ使用を抑えつつ通知的な形で使用できる

## 応用

- 異なるゴルーチンでデータを共有する方法としては「チャネル」と「sync.Mutexなどのメモリロックを使って同じメモリを共有する」方法があるが、チャネルが推奨される
- if文でのチャネル待ち受けは注意が必要。複数並べた際に、チャネルに送信された値が空だった場合にデッドロックが起きてしまうので、判定処理を行いたい場合は`select`を使用する

## 題材

- https://zenn.dev/hsaki/books/golang-concurrency
