# ピュアなGo言語のみでWebアプリケーションを実装する

## 概要

[伸び悩んでいる3年目Webエンジニアのための、Python Webアプリケーション自作入門](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python)をGoで実装した際のメモ帳。
実際のソースコードはこちら: https://github.com/nyuusen/pure-go-web-app

※ピュアなGo言語といっても、低レイヤすぎる箇所(TCPコネクション等)は標準ライブラリを使用


## TCPコネクションの確立

- `listener.Accept()`でTCPコネクションを確立させる
- 内部的には`TCPConn`インスタンスを作成している
- `Accept()`の責務としては、`TCPConn`インスタンスを作成するのみであり、以降のリクエスト/レスポンス処理は`TCPConn`が行う
- `TCPConn`については、[ネットワーク｜Goから学ぶI/O](https://zenn.dev/hsaki/books/golang-io-package/viewer/netconn#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%28net.tcpconn%E3%81%AE%E6%AD%A3%E4%BD%93%29)が参考になった。

## ソケットとは？

- ネットワーク通信のために作られるソフトウェア的な構造で、通信のエンドポイントとして機能する
- アプリケーションとネットワーク層を結びつけるインターフェースであり、TCP通信において重要な役割を果たしている

### ソケットがやること

- アプリケーションが送信したデータをTCPプロトコルに渡してネットワーク層へ送信する
- 逆に、ネットワーク層から受信したデータをアプリケーションに渡すこともする
- 接続の確立や終了(3wayハンドシェイク)を管理する

### 必要性

- 前提として、TCP通信はデータを送受信するために必ず双方向の通信チャネルが必要である
- この前提を満たすために、以下の理由で必要となる
  - ソケットがこのチャネルを作成・管理する役割を果たしている
  - ソケットが接続情報(IPやポート番号)を保持する
    - 1つのサーバーが複数のクライアントと通信する場合、ソケットごとに接続を管理する
    - この仕組みがあることで、各クライアントとの通信が独立して行われる

### 実装に落とし込むと..

- 双方向の通信チャネルに必要ということで、サーバー側もクライアント側もソケットの作成が必要となる
- サーバー側
  - ソケットを作成する
  - ポートにバインドする
  - 接続してきたクライアントごとに新しいソケットを生成し、それぞれ独立した通信を行う(これは内部的に行われている?)
- クライアント側
  - サーバーに接続するためのソケットを作成する(作成時に接続先の指定が必要)
  - ソケットを通じてデータの送受信を行う