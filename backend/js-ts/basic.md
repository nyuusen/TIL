# JavaScriptとTypeScriptの色々まとめる

## JavaScriptとは？

JavaScriptは、ウェブブラウザ上で動作するプログラミング言語。主に以下の特徴がある。

- **動的型付け**: 変数の型を明示的に指定する必要がなく、実行時に型が決まる。
- **インタプリタ言語**: ソースコードを逐次解釈しながら実行する。
- **オブジェクト指向**: オブジェクトを使ったプログラミングが可能。
- **イベント駆動**: ユーザーの操作や他のイベントに応じて動作を制御する。

JavaScriptは、ウェブページの動的な操作やユーザーインターフェースの構築に広く利用されている。

## ECMAScriptとは？

ECMAScriptは、JavaScriptの標準仕様を定めたスクリプト言語。ECMAScriptの仕様は、ECMAインターナショナルによって策定されている。以下のようなバージョンがある。

- **ES5 (ECMAScript 5)**: 2009年にリリースされ、多くのブラウザでサポートされている。
- **ES6 (ECMAScript 2015)**: 2015年にリリースされ、クラス構文やモジュール、アロー関数など多くの新機能が追加された。
- **ESNext**: ES6以降、毎年新しいバージョンがリリースされており、最新の仕様を指す。

ECMAScriptは、JavaScriptの進化を支える基盤となっており、ブラウザやNode.jsなどの実行環境でサポートされている。

## 実行環境(ブラウザとNode.js)について

JavaScriptは、主に以下の2つの実行環境で動作する。

### ブラウザ

ブラウザは、ウェブページを表示するためのソフトウェアであり、JavaScriptを実行するためのエンジンを内蔵している。代表的なブラウザには、Google Chrome、Mozilla Firefox、Microsoft Edge、Safariなどがある。ブラウザ環境では、以下のような特徴がある。

- **DOM操作**: ドキュメントオブジェクトモデル (DOM) を通じて、HTMLやCSSを動的に操作できる。
- **イベントハンドリング**: ユーザーの操作（クリック、入力など）に応じて動作を制御できる。
- **セキュリティ制限**: クロスサイトスクリプティング (XSS) やクロスオリジンリソースシェアリング (CORS) などのセキュリティ制限がある。

### Node.js

Node.jsは、サーバーサイドでJavaScriptを実行するためのランタイム環境。GoogleのV8 JavaScriptエンジンを使用しており、高速な実行性能を持つ。Node.js環境では、以下のような特徴がある。

- **非同期I/O**: 非同期処理を標準でサポートしており、高いスループットを実現する。
- **モジュールシステム**: CommonJSモジュールシステムを使用して、モジュールのインポートやエクスポートが可能。
- **豊富なパッケージ**: npm (Node Package Manager) を通じて、多数のパッケージを簡単に利用できる。

ブラウザとNode.jsは、それぞれ異なる用途に特化した実行環境であり、JavaScriptの多様な利用シーンを支えている。

## JavaScriptにおけるモジュールシステム

### そもそもモジュールシステムとは？

モジュールシステムとは、コードを再利用可能な部品（モジュール）に分割し、他の部分からインポートして使用できる仕組みのこと。これにより、コードの管理が容易になり、再利用性が向上する。

### モジュールシステムがないことの辛み

モジュールシステムがない場合、以下のような問題が発生する。

- **グローバルスコープの汚染**: すべての変数や関数がグローバルスコープに存在するため、名前の衝突が発生しやすい。
- **依存関係の管理が困難**: どのスクリプトがどのスクリプトに依存しているかを手動で管理する必要がある。
- **コードの再利用が難しい**: 同じコードを複数の場所で使いたい場合、コピー＆ペーストするしかない。

### CommonJSの誕生

CommonJSは、サーバーサイドJavaScript（特にNode.js）向けに設計されたモジュールシステム。以下の特徴がある。

- **同期的なモジュール読み込み**: `require` 関数を使ってモジュールを同期的に読み込む。
- **モジュールのエクスポート**: `module.exports` を使ってモジュールの公開インターフェースを定義する。

### ESModulesの誕生

ESModules（ESM）は、ECMAScript 2015（ES6）で標準化されたモジュールシステム。以下の特徴がある。

- **静的なモジュール読み込み**: `import` 文を使ってモジュールを静的に読み込む。
- **モジュールのエクスポート**: `export` 文を使ってモジュールの公開インターフェースを定義する。
- **非同期的なモジュール読み込み**: ブラウザやNode.jsの実装では、モジュールを非同期に読み込むことができる。

### CommonJSとESModulesの比較

- **読み込み方法**:
  - CommonJS: `require` 関数を使って同期的に読み込む。
  - ESModules: `import` 文を使って静的に読み込む。

- **エクスポート方法**:
  - CommonJS: `module.exports` を使ってエクスポートする。
  - ESModules: `export` 文を使ってエクスポートする。

- **実行環境**:
  - CommonJS: 主にNode.jsで使用される。
  - ESModules: ブラウザとNode.jsの両方で使用される。

- **依存関係の解析**:
  - CommonJS: 実行時に依存関係を解析する。
  - ESModules: 静的に依存関係を解析するため、ビルドツールによる最適化が容易。

- **非同期読み込み**:
  - CommonJS: 同期的な読み込みのみサポート。
  - ESModules: 非同期的な読み込みをサポート。

これらの違いにより、ESModulesはモダンなJavaScript開発において推奨されるモジュールシステムとなっている。

## TypeScriptによる型システムの誕生

### TypeScriptとは？

TypeScriptは、Microsoftによって開発されたJavaScriptのスーパーセット。静的型付けをサポートし、開発時に型チェックを行うことで、バグを未然に防ぐことができる。TypeScriptはJavaScriptのすべての機能を含んでおり、追加の型システムや最新のJavaScript機能を利用できる。

### TypeScriptとJavaScriptの関係性

TypeScriptはJavaScriptのスーパーセットであり、すべてのJavaScriptコードは有効なTypeScriptコードでもある。TypeScriptは、JavaScriptに型システムを追加することで、コードの品質と保守性を向上させる。TypeScriptで書かれたコードは、最終的にJavaScriptにコンパイルされ、ブラウザやNode.jsで実行される。

### TypeScriptをJavaScriptに変換して実行するまでの流れ

1. **TypeScriptでソースコードを記述する**:
   - TypeScriptファイル（.ts）を作成し、コードを記述する。
   - 型注釈やインターフェースを使用して、型安全なコードを書く。

2. **tsconfig.jsonを設定する**:
   - プロジェクトのルートにtsconfig.jsonファイルを作成し、コンパイルオプションを設定する。
   - コンパイルターゲットやモジュールシステム、出力ディレクトリなどを指定する。

3. **TypeScriptコンパイラ（tsc）を使用してコンパイルする**:
   - `tsc`コマンドを実行して、TypeScriptコードをJavaScriptにコンパイルする。
   - コンパイルされたJavaScriptファイルは、指定された出力ディレクトリに生成される。

4. **JavaScriptファイルを実行する**:
   - コンパイルされたJavaScriptファイルをNode.jsやブラウザで実行する。
   - Node.jsの場合、`node`コマンドを使用して実行する。

この流れにより、TypeScriptで書かれたコードをJavaScriptに変換し、実行することができる。TypeScriptは、型システムを活用することで、より安全で保守性の高いコードを書くことができる。

## まとめ的な

### 各関係者やファイルの整理

- Node.js
  - ランタイム
  - サーバーサイド JavaScript 実行環境

- npm (package.json と package-lock.json)
  - パッケージ管理システム
  - 外部パッケージを読み込んで使ったりすることを簡単にしてくれる
  - `package.json` はプロジェクトの依存関係やスクリプトを定義
  - `package-lock.json` は依存関係の正確なバージョンを固定

- tsconfig.json
  - TypeScript を JavaScript にトランスパイルするときの設定ファイル
  - トランスパイル時のターゲットバージョンやモジュールシステムなどの設定が書かれている

- コンパイルツール(tsx や ts-node)
  - TypeScript ランタイム
  - TypeScript ファイルを直接実行するためのライブラリ

- ビルドツール(webpack や esbuild)
  - JavaScript のビルドツール
  - トランスパイルやバンドルを行う
  - `webpack` はプラグインやローダーが豊富で柔軟性が高い
  - `esbuild` は非常に高速なビルドが特徴

### サーバーサイドにおける開発から実行までの流れ

- TypeScript でソースコードを記述する
  - 直接 TypeScript ファイルを書いたり
  - npm を使用して外部パッケージを使ったり

- tsx や ts-node を使用して TypeScript を JavaScript に変換する
  - 開発中に直接実行する場合に便利

- esbuild や webpack を使用して 1 つの JavaScript ファイルにバンドルする
  - 本番環境向けに最適化
    - minify: 変数名短くしたり、スペース削除して、ファイルサイズを小さくする
    - tree shaking: 未使用モジュールを削除
- [JavaScriptビルドツールの整理 各ツールの機能と依存関係](https://zenn.dev/righttouch/articles/86457bf2908379#%E5%90%84%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%93%E3%81%A8%E6%95%B4%E7%90%86)

- Node.js がインストールされた環境で、JavaScript ファイルを実行する

### 各用語の整理

- バンドル
  - 複数の JavaScript ファイルを 1 つに束ねる
  - 依存関係を解決し、1 つのファイルにまとめることで読み込みを効率化

- トランスパイル
  - TypeScript の文脈では、TypeScript ファイルを特定のバージョンの JavaScript に書き出す
  - JavaScript の文脈では、JavaScript ファイルを特定のバージョンの JavaScript に書き出す

- ビルド
  - 上記のバンドルやトランスパイルをまとめて、ソースコードを実行可能な状態まで仕上げる全体的な工程を指している
  - 使用する人によって意味がブレる（言葉自体の定義がふわっとしている）