# ハッシュ化・ソルト・ペッパー

## ハッシュ化だけではセキュリティリスクが高い理由

- 単なるハッシュ値が漏洩した場合、攻撃者側でよく使われるパスワードとそのハッシュ値を事前計算してテーブル化しておいたものと照合するレインボーテーブル攻撃のリスクが高いため

## ソルト

- レコード毎にランダム値（乱数）を生成し、パスワード＋ソルトをハッシュ化することでセキュリティ性を向上させる
- この際、ソルトは同一レコードの値として保存することが多い
- 同一レコードだと漏洩した時に危険なのでは？
  - 漏洩した場合、1レコードに含まれるのはハッシュ値(パスワード+ソルトをハッシュ化したもの)とソルト値
  - 攻撃者が保持しているのは、大抵ソルトなしのパスワードハッシュなので、ソルトありのハッシュ値一覧は当然保持していない
  - テーブル化するには再度計算が必要になるので、漏洩後にパスワードが盗用されるまでの時間を稼ぐことができる
- 詳しい解説がされている徳丸さんの記事: [ソルト付きハッシュのソルトはどこに保存するのが一般的か #Security - Qiita](https://qiita.com/ockeghem/items/d7324d383fb7c104af58)

## ペッパー

- こちらはレコード毎ではなく全てのレコードで1つの固定値をパスワードに付加する
- ペッパーは、SecretsManagerなどの秘匿情報を保持する専用の箱か、それをECSタスクの環境変数としてSecretsManagerから取得するようにする形が良さそう
  - 前者の方がセキュリティ性は高いけど、ハッシュ化のたびにSecretsManagerへのリクエストが発生するので、費用面とパフォーマンス面でデメリットあり